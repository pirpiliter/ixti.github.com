<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Get UTF-8 string from array of bytes in Node.JS * ixti's personal scratchpad</title>
    <meta name="description" content="Personal blog of Aleksey V Zapparov AKA ixti">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content="jekyll">
    <link rel="stylesheet" type="text/css" href="/assets/app-c154aec9e7bb397b6af4159d0e0ef1a6.css">
  </head>
  <body>
    <header id="header">
      <h1><a href="/"><span>personal scratchpad</span></a></h1>
      <div id="top-navigation" class="navbar">
        <ul>
          <li><a href="https://github.com/ixti/ixti.github.com">Sources</a></li>
        </ul>
        <ul>
          <li><a href="https://github.com/ixti">GitHub</a></li>
          <li><a href="http://es.linkedin.com/in/zapparov">LinkedIn</a></li>
          <li><a href="https://twitter.com/zapparov">Twitter</a></li>
          <li><a href="http://feeds.feedburner.com/ixti">RSS</a></li>
        </ul>
      </div>
    </header>

    <article class="post">
  <header>
    <h2>Get UTF-8 string from array of bytes in Node.JS</h2>
    
    <dl class="post-info">
  <dt>Date:</dt>
  <dd>26 Oct 2011</dd>

  
    <dt>Category:</dt>
    <dd><a href="/categories/development/node.js.html">development/node.js</a></dd>
  

  
    <dt>Tagged with:</dt>
    <dd><a href="/tags/utf-8.html">utf-8</a>, <a href="/tags/decode.html">decode</a>, <a href="/tags/string.html">string</a>, and <a href="/tags/javascript.html">javascript</a></dd>
  
</dl>

  </header>

  <p>While I was working on <a href="https://github.com/nodeca/js-yaml">js-yaml</a> - JavaScript port of PyYAML (by the time of
writing this post, js-yaml is still in WIP stage), I found that I need something
to convert stream of bytes into a string. So this is a quick and simple example
of how to get an UTF8 string from the stream of bytes.</p>

<p>Lets start with problem definition: &ldquo;We need to get string from its
representation in bytes&rdquo;. In python it would be something akin
to this (assuming <code>codes</code> is a list of integers):</p>
<div class="highlight"><pre><code class="python"><span class="nb">bytes</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
</code></pre></div>
<p>Now lets encode and then decode a Russian word, that describes my feeling about
using JavaScript on the server: <code>какашка</code>. We can get array of UTF8 bytes
representation of a string with following snippet:</p>
<div class="highlight"><pre><code class="javascript"><span class="kd">function</span> <span class="nx">getBytes</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">bytes</span> <span class="o">=</span> <span class="p">[],</span> <span class="kr">char</span><span class="p">;</span>
  <span class="nx">str</span> <span class="o">=</span> <span class="nb">encodeURI</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">char</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">str</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;%&#39;</span> <span class="o">!==</span> <span class="kr">char</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">bytes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kr">char</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kr">char</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
      <span class="nx">str</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

      <span class="nx">bytes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="kr">char</span><span class="p">,</span> <span class="mi">16</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">bytes</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>The function above returns an array of integers, so for example, it will return
<code>[90]</code> for <code>&#39;Z&#39;</code>, or <code>[208, 175]</code> for <code>&#39;Я&#39;</code> or <code>[90, 208, 175]</code> for <code>&#39;ZЯ&#39;</code>. Now
lets get bytes array for our &ldquo;magic word&rdquo;&hellip;</p>
<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">bytes</span> <span class="o">=</span> <span class="nx">getBytes</span><span class="p">(</span><span class="s1">&#39;какашка&#39;</span><span class="p">);</span>
<span class="c1">// -&gt; [ 208, 186, 208, 176, 208, 186, 208, 176, 209, 136, 208, 186, 208, 176 ]</span>
</code></pre></div>
<p>And now! Ladies and Gentlemen! <em>*drum roll*</em> Here is our snippet to get
string representation back:</p>
<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">buff</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">bytes</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">buff</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">));</span>
<span class="c1">// -&gt; какашка</span>
</code></pre></div>
</article>



<!-- DISQUS -->
<div id="disqus_thread"></div>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


    <ul id="bottom-navigation" class="navbar">
      
        <li><a href="/archives/2012.html">2012</a></li>
      
        <li><a href="/archives/2011.html">2011</a></li>
      
        <li><a href="/archives/2010.html">2010</a></li>
      
    </ul>

    <footer id="footer" role="contentinfo">
      kindly generated by <a href="https://github.com/mojombo/jekyll">Jekyll</a>
      ~
      crafted by <a href="http://ixti.net">ixti</a>
      using <a href="http://gimp.org/">Gimp</a>
      and <a href="http://www.vim.org/">Vim</a>
      ~
      copyright &copy; 2010 Aleksey V Zapparov AKA ixti
    </footer>

    <script type="text/javascript" src="/assets/app-6136a26d0eb3d21f7cc38a822c932959.js"></script>
  </body>
</html>
